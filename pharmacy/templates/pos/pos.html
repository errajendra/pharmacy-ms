<html lang="en"><head>
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Title -->
    <title>Create a new invoice | Point of Sale</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="/static/pos/pwa-icon/icon-72x72.png">
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&amp;display=swap" rel="stylesheet">
    <!-- CSS Front Template -->
    <link rel="stylesheet" href="/static/pos/pos/css/theme.css?time=1712655540">
    
    <link rel="stylesheet" href="/static/pos/pos/css/style.css?time=1712655540">

    <!-- <script src="/static/pos/pos/vendor/hs-navbar-vertical-aside/hs-navbar-vertical-aside-mini-cache.js"></script> -->
    <link rel="stylesheet" href="/static/pos/pos/css/toastr.css">
    <link rel="stylesheet" type="text/css" href="/static/pos/slick/slick.css">
    <link rel="stylesheet" type="text/css" href="/static/pos/slick/slick-theme.css">
    <link rel="stylesheet" href="/static/pos/pos/css/pos.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- PWA  -->
    <meta name="theme-color" content="#7367f0">
    <style>
        .user-profile-button .dropdown-menu.show {
            left: -126px;
        }

        .category-slider .slick-slide {
            padding: 0 4px;
        }

        div#product-list {
            height: 85vh;
            overflow: hidden;
            overflow-y: scroll;
        }

        .dropdown-item i {
            font-size: 23px;
            color: #44444473;
        }
        .stockout {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #ffffff6b;
            backdrop-filter: blur(1px);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 5px;
        }
    </style>
<link rel="stylesheet" type="text/css" property="stylesheet" href="//demopharma.ayaantec.com/_debugbar/assets/stylesheets?v=1683196766&amp;theme=auto" data-turbolinks-eval="false" data-turbo-eval="false"><script src="//demopharma.ayaantec.com/_debugbar/assets/javascript?v=1683196766" data-turbolinks-eval="false" data-turbo-eval="false"></script><script data-turbo-eval="false">jQuery.noConflict(true);</script>
</head>
<body class="footer-offset pos-interface" style="margin-bottom: 85px;">
    
    {% comment %} <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div id="loading" class="d-none">
                    <div class="pvl1">
                        <img width="200" src="https://demopharma.ayaantec.com/public/pos/img/loader.gif">
                    </div>
                </div>
            </div>
        </div>
    </div> {% endcomment %}
    
    <main id="content" role="main" class="main pointer-event">
        <section class="section-content padding-y-sm bg-default mt-2">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        
                        <!-- =================================CATEGORIAS================================= -->
                        {% comment %} <div class="row mb-2 category-slider slick-initialized slick-slider">
                            <button class="slick-prev slick-arrow" aria-label="Previous" type="button" style="">Previous</button>
                            
                            <div class="slick-list draggable"><div class="slick-track" style="opacity: 1; width: 4602px; transform: translate3d(-826px, 0px, 0px);">
                                {% for cat in categories %}
                                <div class="slick-slide slick-cloned" data-slick-index="{{cat.id}}" id="" aria-hidden="true" style="width: 118px;" tabindex="-1">
                                    <div>
                                        <label for="category{{cat.id}}" class="category-box " style="width: 100%; display: inline-block;">
                                            <input class="d-none" id="" type="radio" value="{{cat.id}}" name="category" onchange="set_category_filter(this.value)" tabindex="-1">
                                            <h6>{{cat.name}} </h6>
                                        </label>
                                    </div>
                                </div>
                                {% endfor %}

                                <div class="slick-slide slick-cloned" data-slick-index="-6" id="" aria-hidden="true" style="width: 118px;" tabindex="-1">
                                    <div>
                                        <label for="category31" class="category-box " style="width: 100%; display: inline-block;">
                                            <input class="d-none" id="" type="radio" value="31" name="category" onchange="set_category_filter(this.value)" tabindex="-1">
                                            <h6>Tablet</h6>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="slick-slide slick-cloned" data-slick-index="-5" id="" aria-hidden="true" style="width: 118px;" tabindex="-1">
                                    <div>
                                        <label for="category20" class="category-box " style="width: 100%; display: inline-block;">
                                            <input class="d-none" id="" type="radio" value="20" name="category" onchange="set_category_filter(this.value)" tabindex="-1">
                                            <h6>Ointment</h6>
                                        </label>
                                    </div>
                                </div>

                                <div class="slick-slide slick-cloned" data-slick-index="27" id="" aria-hidden="true" style="width: 118px;" tabindex="-1">
                                    <div>
                                        <label for="category20" class="category-box " style="width: 100%; display: inline-block;">
                                            <input class="d-none" id="" type="radio" value="20" name="category" onchange="set_category_filter(this.value)" tabindex="-1">
                                            <h6>Ointment</h6>
                                        </label>
                                    </div>
                                </div>

                            </div>
                            </div>
                            <button class="slick-next slick-arrow" aria-label="Next" type="button" style="">Next</button>
                        </div> {% endcomment %}
                        
                        <div class="row mb-2">
                            <div class="col-12 col-sm-12 col-md-4 col-lg-6 px-1">
                                <form class="search-box">
                                    <div class="pre-append">
                                        <i class="tio-search"></i>
                                    </div>
                                    <input id="search" onkeyup="searchProducts()" autocomplete="off" type="text" value="" name="search" class="form-control search-bar-input" placeholder="Search here" aria-label="Search here">
                                    <!-- Search -->
                                    {% comment %} <input id="search" autocomplete="off" type="text" value="" name="search" class="form-control search-bar-input" placeholder="Search here" aria-label="Search here"> {% endcomment %}
                                    
                                    <div class="append">
                                        <i class="tio-barcode"></i>
                                    </div>
                                    <div class="input-group-overlay input-group-merge input-group-flush">
                                        <div class="input-group-prepend">

                                        </div>

                                        <div class="card search-card w-4 pvl5" style="font-weight:600">
                                            <div id="search-box" class="card-body search-result-box d-none"></div>
                                        </div>
                                    </div>
                                    <!-- End Search -->
                                </form>
                            </div>
                            <div class="col-12 col-sm-12 col-md-4 col-lg-3 px-1 my-2 my-lg-0">
                                <div class="input-group float-right">
                                    <select name="category" id="category" onchange="searchProducts()" class="form-control" title="select category" tabindex="-1" aria-hidden="true">
                                        <option value="">--All Category--</option>
                                        {% for c in categories %}
                                        <option value="{{c.id}}">{{c.name}} </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="col-12 col-sm-12 col-md-4 col-lg-3 px-1 my-2 my-lg-0">
                                <div class="input-group float-right">
                                    <select name="vendor" id="vendor" onchange="searchProducts()" class="form-control" title="select category" tabindex="-1" aria-hidden="true">
                                        <option value="">--All Vender--</option>
                                        {% for v in venders %}
                                        <option value="{{v.id}}">{{v.name}} </option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                    
                    {% comment %} Product Listing {% endcomment %}
                    <div class="row mb-2" id="product-list">

                        {% for drug in drugs %}
                            <div class="col-lg-3 col-6 col-xl-3 px-2 mb-3">
                                <div class="position-relative">
                                    <div class="product-card card shadow-sm pvl26 position-relative" onclick="addToCart({{drug.id}}, 'med')">
                                        <div class="card-header inline_product clickable p-3 pvl27">
                                            <div class="d-flex align-items-center justify-content-center d-block">
                                                <img src="{{drug.drug_pic.url}}" onerror="this.src='/static/demo-med.png'" class="pvl28">
                                            </div>
                                        </div>
                                        <div class="card-body inline_product text-center p-1 py-2 clickable">
                                            <h5 class="product-title1 text-dark font-weight-bold pvl30">
                                                {{drug.drug_name}} ({{drug.category.name}})
                                            </h5>
                                        </div>
                                    </div>
                                    {% if drug.quantity > 0 %}
                                    <span class="position-absolute top-0 end-0 badge bg-primary text-white m-1">QTY: {{drug.quantity}} </span>
                                    {% else %} 
                                    <div class="stockout">
                                        <span class="badge bg-danger text-white">Out of stock</span>
                                    </div>
                                    {% endif %} 
                                </div>
                            </div>
                        {% endfor %}

                        
                        {% for item in items %}
                            <div class="col-lg-3 col-6 col-xl-3 px-2 mb-3">
                                <div class="position-relative">
                                    <div class="product-card card shadow-sm pvl26 position-relative" onclick="addToCart({{item.id}}, 'item')">
                                        <div class="card-header inline_product clickable p-3 pvl27">
                                            <div class="d-flex align-items-center justify-content-center d-block">
                                                <img src="/static/demo-item.png" onerror="this.src='/static/demo-item.png'" class="pvl28">
                                            </div>
                                        </div>
                                        <div class="card-body inline_product text-center p-1 py-2 clickable">
                                            <h5 class="product-title1 text-dark font-weight-bold pvl30">
                                                {{item.name}}
                                            </h5>
                                        </div>
                                    </div>
                                    <span class="position-absolute top-0 end-0 badge bg-primary text-white m-1">Unit: {{item.unit}} </span>
                                    
                                </div>
                            </div>
                        {% endfor %}

                        {% comment %} <div class="col-lg-3 col-6 col-xl-3 px-2 mb-3">
                            <div class="position-relative">
                            <div class="product-card card shadow-sm pvl26 position-relative" onclick="ADD_TO_CART('16','https://api.cart.com')">
                                <div class="card-header inline_product clickable p-3 pvl27">
                                    <div class="d-flex align-items-center justify-content-center d-block">
                                        <img src="https://demopharma.ayaantec.com/public/pos/img/160x160/imag.png" onerror="this.src='https://demopharma.ayaantec.com/public/pos/img/160x160/imag.png'" class="pvl28">
                                    </div>
                                </div>
                                <div class="card-body inline_product text-center p-1 py-2 clickable">
                                    <h5 class="product-title1 text-dark font-weight-bold pvl30">
                                        Rakibul Hassa... (856)
                                    </h5>
                                </div>
                            </div>
                                        <span class="position-absolute top-0 end-0 badge bg-primary text-white m-1">
                            QTY: 5
                            </span>
                                </div>

                        </div> {% endcomment %}
                        
                        <div class="col-lg-12"></div>
                        </div>

                    </div>
                    

                    <div class="col-md-6 pr-0">
                        <form onsubmit="placeOrder()" id="placeOrder" action="https://demopharma.ayaantec.com/pos/order">
                            <div class="card bg-transparent shadow-none pr-1 pl-1 cart-table">
                                <div class="row mb-2 align-items-center">
                                    <div class="col-lg-3 my-2 my-lg-2">
                                        <button class="w-100 d-inline-block btn btn-info btn rounded" id="add_new_customer" type="button" data-toggle="modal" data-target="#add-customer" title="Add Customer">
                                            <i class="tio-user-add"></i> Add new customer
                                        </button>
                                    </div>
                                    <div class="col-lg-3">
                                        {% comment %} <select onchange="customer_change(this.value);" id="customer" name="customer_id" data-placeholder="Walk In Customer" class="form-control"> {% endcomment %}
                                            <select onchange="getCartDetails();" id="customer" name="customer" class="form-control selectpickerhg" data-live-search="true">
                                            {% comment %} <option value="0" selected> Walking Customer </option> {% endcomment %}
                                            {% for c in custumers %}
                                            <option value="{{c.id}}" {% if request.session.pos_custumer == c.id %} selected="" {% endif %}> {{c.get_full_name}} ({{c.username}})</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-lg-3">
                                        <input type="text" id="doctorName" class="form-control" placeholder="Enter Doctor Name" />
                                    </div>

                                    <div class="col-lg-3 text-right">
                                        <div class="d-flex align-items-center justify-content-end">
                                            {% comment %} <button data-toggle="modal" data-target="#short-cut-keys" class="btn btn-warning rounded mx-2" type="button" title="Keyboard shortcuts">
                                                <i class="tio-keyboard text-white"></i>
                                            </button> {% endcomment %}
                                            <a href="{% url 'pos_billing_history' %}" class="btn btn-primary rounded mx-1 mr-4" type="button" title="POS History">
                                                <i class="fa fa-list"></i>
                                            </a>
                                            <a href="/" class="btn btn-primary rounded mx-1 mr-4" type="button" title="Back to Dashboard">
                                                <i class="fa fa-dashboard"></i>
                                            </a>
                                            <div class="dropdown user-profile-button">
                                                <a href="javascript:" class="avatar avatar-circle" data-toggle="dropdown">
                                                    <img class="avatar-img" onerror="this.src='https://demopharma.ayaantec.com/public/pos/img/160x160/img1.jpg'" src="https://fgcucdn.fgcu.edu/_resources/images/faculty-staff-male-avatar-200x200.jpg" alt="Image">
                                                    <span class="avatar-status avatar-sm-status avatar-status-success"></span>
                                                </a>
                                                <div class="dropdown-menu" style="transform: translate3d(-124px, 50px, 5px);">
                                                    <a class="dropdown-item" href="javascript:">
                                                        <i class="tio-user"></i>Super Admin
                                                    </a>
                                                    <a class="dropdown-item" href="#">
                                                        <i class="tio-shopping-basket"></i> Purchase
                                                    </a>
                                                    <a class="dropdown-item" href="{% url "logout" %}">
                                                        <i class="tio-sign-out"></i> Logout
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="w-100" id="cart">
                                    <div class="cart-calculation">
                                        <div class="table-responsive">
                                            <table class="table table-bordered" id="cart-table">
                                                <thead>
                                                    <tr>
                                                        <th>Medicine</th>
                                                        <th>Batch </th>
                                                        <th>Expiry Date</th>
                                                        <th>Quantity</th>
                                                        <th>Price</th>
                                                        {% comment %} <th>Discount%</th> {% endcomment %}
                                                        <th>Total</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="cart_items">
                                                    
                                                </tbody>
                                            </table>
                                            <table>
                                                <tr>
                                                    <td>
                                                        <div class="">
                                                            <input id="search-input" type="text" placeholder="Search & Add Medicine" class="form-control">
                                                            <!-- Change select to ul -->
                                                            <ul id="search-results" class="list-group" style="display: none;"></ul>
                                                        </div>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>

                                        {% comment %} Sub total {% endcomment %}
                                        <div class="form-group mb-1">
                                            <div class="row justify-content-end align-items-center">
                                                <label for="subtotal" class="col-5 col-sm-6 col-lg-6 col-xl-7 text-right font-weight-bold mb-0">
                                                    Sub Total:
                                                </label>
                                                <div class="col-5 col-sm-5 col-lg-5 col-xl-3">
                                                    <input type="text" class="form-control form-control-sm text-right" id="subtotal" data-subtotal="0" name="subtotal" value="0.00" placeholder="0.00" readonly="readonly" aria-invalid="false">
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Invoicing  -->
                                        <div class="form-group mb-1">
                                            <div class="row justify-content-end align-items-center">
                                                <label for="invoice_discount" class="col-5 col-sm-6 col-lg-6 col-xl-7 text-right font-weight-bold mb-0">
                                                    Invoice Discount %:
                                                </label>
                                                <div class="col-5 col-sm-5 col-lg-5 col-xl-3">
                                                    <select name="invoice_discount_type" onchange="calculateGrandTotal();" id="invoice__discount__type" class="form-control form-control-sm text-start">
                                                        <option value="fixed">Fixed</option>
                                                        <option value="percent">Percent</option>
                                                    </select>
                                                    <input type="text" class="form-control form-control-sm text-right" id="invoice_discount" name="invoice_discount" placeholder="0.00" onkeyup="calculateGrandTotal();" onchange="calculateGrandTotal();">
                                                    <input type="hidden" id="total_product_dis" value="0">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="form-group mb-1">
                                            <div class="row justify-content-end align-items-center">
                                                <label for="total_discount_ammount" class="col-5 col-sm-6 col-lg-6 col-xl-7 text-right font-weight-bold mb-0">Total Discount:</label>
                                                <div class="col-5 col-sm-5 col-lg-5 col-xl-3">
                                                    <input data-totalamount="0" type="text" id="total_discount_ammount" class="form-control form-control-sm gui-foot text-right valid_number" name="total_discount" value="0" readonly="">
                                                </div>
                                            </div>
                                        </div>

                                        {% comment %} <div class="form-group mb-1">
                                            <div class="row justify-content-end align-items-center">
                                                <label for="vat" class="col-5 col-sm-6 col-lg-6 col-xl-7 text-right font-weight-bold mb-0">
                                                    Vat :
                                                </label>
                                                <div class="col-5 col-sm-5 col-lg-5 col-xl-3">
                                                    <input id="vat" tabindex="-1" class="form-control gui-foot text-right valid totalTax valid_number" name="total_tax0" value="0" readonly="readonly" aria-invalid="false" type="text">
                                                </div>
                                            </div>
                                        </div> {% endcomment %}

                                        <div class="form-group mb-1">
                                            <div class="row justify-content-end align-items-center">
                                                <label for="tax_amount" class="col-5 col-sm-6 col-lg-6 col-xl-7 text-right font-weight-bold mb-0">
                                                    GST/ Tax Amount% :
                                                </label>
                                                <div class="col-5 col-sm-5 col-lg-5 col-xl-3">
                                                    <input id="tax_amount" tabindex="-1" onkeyup="calculateGrandTotal()" onchange="calculateGrandTotal()" class="form-control gui-foot text-right valid totalTax valid_number" name="gst_tax_amount" value="0.00" type="number">
                                                    <small class="float-right" id="taxAmount"></small>
                                                </div>
                                            </div>
                                        </div>

                                        {% comment %} <div class="form-group mb-1">
                                            <div class="row justify-content-end align-items-center">
                                                <label for="igta_amount" class="col-5 col-sm-6 col-lg-6 col-xl-7 text-right font-weight-bold mb-0">
                                                    IGTA :
                                                </label>
                                                <div class="col-5 col-sm-5 col-lg-5 col-xl-3">
                                                    <input id="igta_amount" tabindex="-1" class="form-control gui-foot text-right valid totalTax valid_number" name="total_tax1" value="0" readonly="readonly" aria-invalid="false" type="text">
                                                </div>
                                            </div>
                                        </div> {% endcomment %}

                                        <div class="form-group mb-1">
                                            <div class="row justify-content-end align-items-center">
                                                <label for="grandTotal" class="col-5 col-sm-6 col-lg-6 col-xl-7 text-right font-weight-bold mb-0">
                                                    Grand Total:</label>
                                                <div class="col-5 col-sm-5 col-lg-5 col-xl-3">
                                                    <input type="text" id="grandTotal" data-grandtotal="0" class="form-control form-control-sm text-right valid_number" name="grand_total_price" value="0.00" placeholder="0.00" readonly="">
                                                </div>
                                            </div>
                                        </div>

                                        {% comment %} <div class="form-group mb-1">
                                            <div class="row justify-content-end align-items-center">
                                                <label for="recieved_amount" class="col-5 col-sm-6 col-lg-6 col-xl-7 text-right font-weight-bold mb-0">
                                                    Recieved Amount:
                                                </label>
                                                <div class="col-5 col-sm-5 col-lg-5 col-xl-3">
                                                    <input type="text" id="recieved_amount" class="form-control form-control-sm gui-foot text-right valid_number" name="recieved_amount" value="0.00" readonly="">
                                                </div>
                                            </div>
                                        </div> {% endcomment %}
                                        
                                        {% comment %} <div class="form-group mb-1">
                                            <div class="row justify-content-end align-items-center">
                                                <label for="change" class="col-5 col-sm-6 col-lg-6 col-xl-7 text-right font-weight-bold mb-0">Change:</label>
                                                <div class="col-5 col-sm-5 col-lg-5 col-xl-3">
                                                    <input type="text" id="change" class="form-control form-control-sm gui-foot text-right valid_number" name="change" value="0.00" readonly="">
                                                </div>
                                            </div>
                                        </div> {% endcomment %}
                                        
                                    </div>
                                </div>
                            </div>
                        </form>
                        
                    </div>
                </div>
            </div>
        </section>

        <button class="action-bar-switcher" onclick="bottomActionBar()">
            <i class="tio-chevron-down"></i>
            <i class="tio-chevron-up" style="display: none"></i>
        </button>

        <div class="action-bottom-bar">
            <div class="container">
                <div class="row align-items-center py-2">
                    <div class="col-lg-12 col-xl-8">
                        <div class="calculation d-lg-flex">
                            <div class="cal-box d-lg-flex align-items-lg-center mr-4 text-nowrap">
                                <label class="cal-label font-weight-bold mr-2 mb-0 text-white">
                                    Net Total:
                                </label>
                                <span class="amount text-white" id="net_total_text">0.00</span>
                                <input type="hidden" id="n_total" name="n_total" value="0.00">
                                <input type="hidden" id="txfieldnum" value="2">
                            </div>
                            {% comment %} <div class="cal-box d-lg-flex align-items-lg-center mr-4">
                                <div class="d-inline-flex align-items-center text-nowrap">
                                    <label class="cal-label font-weight-bold mr-2 mb-0 text-white">Paid Amount:</label>
                                    <input type="number" class="form-control form-control-sm valid_number" placeholder="0.00" onkeyup="invoice_paidamount(this.value)" onchange="invoice_paidamount(this.value)" id="paidAmount" name="paid_amount">
                                </div>
                            </div> {% endcomment %}
                            {% comment %} <div class="cal-box d-lg-flex align-items-lg-center mr-4">
                                <label class="cal-label font-weight-bold mr-2 mb-0 text-white">Due Amount:</label><span class="amount text-white" id="due_text">0.00</span>
                                <input type="hidden" id="due_amount" name="due_amount" value="0.00">
                            </div> {% endcomment %}
                        </div>
                    </div>
                    <div class="col-lg-12 col-xl-4 text-xl-right">
                        <div class="action-btns d-flex justify-content-center justify-content-xl-end mt-2 mt-xl-0">
                            <input type="button" id="full_paid_tab" class="btn btn-warning font-weight-600 mr-2" value="Place Order" onclick="placeOrderNew()">
                            {% comment %} <button type="button" onclick="placeOrder('Cash Payment')" id="placeOrderWithCash" class="btn btn-success font-weight-600 mr-2">
                                Cash Payment
                            </button>
                            <button type="button" class="btn btn-info font-weight-600 mr-2" data-toggle="modal" data-target="#paymentModal" aria-expanded="false">
                                MFS Payment
                            </button>
                            <input type="hidden" name="bank_id" value="3" id="bank_id">
                            <input type="hidden" name="payment_type" value="2" id="payment_type"> {% endcomment %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="quick-view" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content" id="quick-view-modal">

                </div>
            </div>
        </div>

        <div class="modal fade" id="emrg-quick-view" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content" id="emrg-quick-view-modal">

                </div>
            </div>
        </div>

        {% comment %} <div class="modal fade" id="calculator" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Calculator</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <span>To click order : alt + O</span><br>
                        <span>To click payment submit : alt + S</span><br>
                        <span>To close payment submit : alt + Z</span><br>
                        <span>To click cancel cart item all : alt + C</span><br>
                        <span>To click add new customer : alt + A</span> <br>
                        <span>To submit add new customer form : alt + N</span><br>
                        <span>To click short cut keys : alt + K</span><br>
                        <span>To print invoice : alt + P</span> <br>
                        <span>To cancel invoice : alt + B</span> <br>
                        <span>To focus search input : alt + Q</span> <br>
                        <span>To click extra discount : alt + E</span> <br>
                        <span>To click coupon discount : alt + D</span> <br>
                        <span>To click clear cart : alt + X</span> <br>
                        <span>To click new order : alt + R</span> <br>

                    </div>
                </div>
            </div>
        </div> {% endcomment %}

        <div class="modal fade" id="add-customer" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add new customer</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form action="{% url 'patient_form' %}" method="post" id="product_form">
                            {% csrf_token %}                          
                            <div class="row pl-2">
                                
                                <input type="hidden" name="pos" class="form-control" value="pos">
                                
                                <div class="col-12 col-lg-4">
                                    <div class="form-group">
                                        <label class="input-label">Name <span class="input-label-secondary text-danger">*</span></label>
                                        <input type="text" name="first_name" class="form-control" value="" placeholder="Name" required="">
                                    </div>
                                </div>
                                
                                <div class="col-12 col-lg-6">
                                    <div class="form-group">
                                        <label class="input-label">Phone<span class="input-label-secondary text-danger">*</span></label>
                                        <input type="tel" name="phone_number" class="form-control" value="" placeholder="Phone" required="">
                                        <small>Enter 10 digit phone number</small>
                                    </div>
                                </div>

                                <div class="col-12 col-lg-6">
                                    <div class="form-group">
                                        <label class="input-label">Email</label>
                                        <input type="email" name="email" class="form-control" value="" placeholder="Email">
                                    </div>
                                </div>

                                <div class="col-12 col-lg-6">
                                    <div class="form-group">
                                        <label class="input-label">Address</label>
                                        <input type="text" name="address" class="form-control" value="" placeholder="Address">
                                    </div>
                                </div>
                                {% comment %} <div class="col-12 col-lg-4">
                                    <div class="form-group">
                                        <label class="input-label">Age(DOB)</label>
                                        <input type="date" name="dob" class="form-control" value="" placeholder="Age">
                                        <small>Select Custumer Date of Birth</small>
                                    </div>
                                </div> {% endcomment %}
                            </div>


                            <hr>
                            <button type="submit" id="submit_new_customer" class="btn btn-primary">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
    </main>
    <audio id="audio" src="/static/pos/music/beep.mp3"></audio>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
    <!-- JS Front -->
    <script src="/static/pos/pos/js/vendor.min.js"></script>
    <script src="/static/pos/pos/js/theme.min.js"></script>
    <script src="/static/pos/pos/js/sweet_alert.js"></script>
    <script src="/static/pos/pos/js/toastr.js"></script>
    <script src="/static/pos/pos/js/calculate.js"></script>
    {% comment %} <script src="/static/pos/pos/js/cart.js"></script> {% endcomment %}
    <script src="/static/pos/slick/slick.js" type="text/javascript" charset="utf-8"></script>

    
    {% comment %} Filering the Products {% endcomment %}
    <script type="text/javascript">
        
        function searchProducts() {
            var keywords = $("#search").val();
            var vender_id = $("#vendor").find(":selected").val();
            var category_id = $("#category").find(":selected").val();

            $.ajax({
                type: 'POST',
                url: '{% url "search_product_pos" %}',
                dataType: 'json',
                data: {
                    "keywords": keywords,
                    "vender_id": vender_id,
                    "category_id": category_id,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(data) {
                    $('#product-list').html(data.result);
                },
            });
        }


    </script>

    {% comment %} Cart Add, Delete and Listing  Functionality {% endcomment %}
    <script type="text/javascript">

        // Event listener for the input event of the search input field
        $('#search-input').on('input', function() {
            var query = $(this).val();
            $.ajax({
                url: "/search-stock/",
                data: {
                    'query': query
                },
                dataType: 'json',
                success: function(data) {
                    $('#search-results').empty();
                    for (var i = 0; i < data.length; i++) {
                        var optionText = '<img src="' + data[i].image + '" class="option-image" style="height:50px;width:50px;"> ' +
                                        '<strong>' + data[i].drug_name + '</strong> - ' +
                                        ' (' + data[i].category + ') ' +
                                        // ' unit-' + data[i].unit + 
                                        // ' batch- ' + data[i].batch + 
                                        ' Rs ' + data[i].price;
                        // Change appending option to li
                        $('#search-results').append('<li data-value="' + data[i].id + '" onclick="addToCart('+ data[i].id + ', `med`)" ' + '>' + optionText + '</li>');
                    }
                    $('#search-results').show();

                }
            });
        });
        
        function playMusic() {
            var audio = document.getElementById("audio");
            audio.play();
        }
        

        function addToCart(product_id, item){
            var customer_id = $("#customer").find(":selected").val();

            $.ajax({
                type: "POST",
                url:'{% url "add_to_cart_pos" %}',
                dataType:'json',
                data:{
                    "user_id": customer_id,
                    "product_id": product_id,
                    "item": item,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(data) {
                    toastr.success('Item has been added in your cart!', {
                        CloseButton: true,
                        ProgressBar: true
                    });
                    getCartDetails();
                    playMusic();
                },
           });
        };


        function deleteFromCart(cart_id){
            $.ajax({
                type: "POST",
                url:'{% url "delete_from_cart_pos" %}',
                dataType:'json',
                data:{
                    "cart_id": cart_id,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(data) {
                    toastr.success('Item has been removed from your cart!', {
                        CloseButton: true,
                        ProgressBar: true
                    });
                    getCartDetails();
                    playMusic();
                },
           });
        };

        function getCartDetails(){
            var customer_id = $("#customer").find(":selected").val();

            $.ajax({
                type: "POST",
                url:'{% url "load_cart_items_pos" %}',
                dataType:'json',
                data:{
                    "user_id": customer_id,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(data) {
                    $('#cart_items').html(data.result);
                    $("#subtotal").val(data.total_cart_price);
                    $("#subtotal").data("subtotal", data.total_cart_price);
                    calculateGrandTotal(); 
                    // clar the search input text
                    $("#search-input").val('');
                    $('#search-results').empty();
                    $("#search-input").focus();
                },
           });
        };


        function cartUpdate(cart_id) {
            // Validate cart_id
            if (!cart_id) {
                console.error("Invalid cart_id");
                return;
            }
            
            // Retrieve values
            var quantity = $("#id_cart_quantity_" + cart_id).val();
            var discount = $("#id_cart_discount_" + cart_id).val();
        
            // AJAX request
            $.ajax({
                type: "POST",
                url: '{% url "cart_item_update_pos" %}',
                dataType: 'json',
                data: {
                    "cart_id": cart_id,
                    "quantity": quantity,
                    "discount": discount,
                    "csrfmiddlewaretoken": '{{ csrf_token }}'
                },
                success: function(data) {
                    $("#id_cart_price_" + cart_id).val(data.price);
                    $("#subtotal").val(data.total_cart_price);
                    $("#subtotal").data("subtotal", data.total_cart_price);
                    calculateGrandTotal(); 
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error:", error);
                }
            });
        }
        

        window.onload = function() {
            getCartDetails();
        };

    </script>

    {% comment %} Place order {% endcomment %}
    <script type="text/javascript">
        
        function placeOrderNew(){
            if (confirm('Are you sure?')){

                const customer_id = $("#customer").find(":selected").val();
                const paid_amount = $('#paidAmount').val();
                const due_amount = $("#due_amount").val();
                const tax = $("#taxAmount").text();
                const drName = $("#doctorName").val();
                
                var grand_total = $('#grandTotal').data('grandtotal'); // Final amount or Net Pay
            
                let req_data = {
                    customer_id: customer_id,
                    sub_total: $('#subtotal').data('subtotal'),
                    invoice_discount_type: $('#invoice__discount__type').val(),
                    invoice_discount: $('#invoice_discount').val(), // discount value
                    total_discount: $('#total_discount_ammount').val(), // Discounted value

                    tax_percent: $('#tax_amount').val(), // tax percentage input applied on 
                    tax: tax,
                    grand_total: grand_total, // Final amount or Net Pay

                    dr_name: drName,
                    
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    
                };


                let batches = document.querySelectorAll('.batch');
                let expires = document.querySelectorAll('#expire');
                let emptyBatch = 0;
                let emptyExpire = 0;

                batches.forEach(batch => {
                    if (batch.value ==  null || batch.value == "") {
                        emptyBatch ++;
                    }
                });

                expires.forEach(expire => {

                    if (expire.value ==  null || expire.value == "") {
                        emptyExpire ++;
                    }
                });

                if (grand_total < 1) {
                    showError("No Amount Found...")
                };

                if (emptyBatch < 1 && emptyExpire < 1) {
                    $.ajax({
                        url: '{% url "place_order_poc_billing" %}',
                        type: "POST",
                        dataType: 'json',
                        data: req_data,
                        success: function (res) {
                            if (res.status != 200){
                                showError(res.message);
                            }
                            if (res.status == 200) {
                                toastr.success(res.message, {
                                    CloseButton: true,
                                    ProgressBar: true
                                });
                                Swal.fire({
                                    title: 'Order has been placed successfully!',
                                    type: 'success',
                                    showCancelButton: true,
                                    cancelButtonColor: '#e01313',
                                    confirmButtonColor: '#161853',
                                    cancelButtonText: 'Cancel',
                                    confirmButtonText: 'Print Invoice',
                                    reverseButtons: true
                                }).then((result) => {
                                    if (result.value) {
                                        window.location.href = res.bill_slip_url;
                                    } else {
                                        window.location.reload()
                                    }
                                })
                            }

                        },
                    });
                }else {
                    showError('Please select batch and expire')
                }

            } else { 
                return false;  
            }
        };

    </script>
    
    <!-- JS Plugins Init. -->
    <script>
        function medicineSearch(keyword) {
            let searchKeyword = keyword.trim()
            $.get({
                url: 'https://api.com/pos/search-products',
                dataType: 'json',
                data: {
                    keyword: keyword.trim(),
                },
                success: function(data) {
                    $('#product-list').empty().html(data.result);
                },
            });
        }   
    </script>
    <script>
        "use strict";

        function customer_change(val) {
            //let  cart_id = $('#cart_id').val();
    
            $('#cart_id').html("output");
            $('#current_customer').text(data.current_customer);
            $('#cart').empty().html(data.view);
        }
    </script>
    <script>
        "use strict";

        function clear_cart() {
            let url = "https://test.com/pos/clear-cart-ids";
            document.location.href = url;
        }
    </script>
    <script>
        "use strict";

        function new_order() {
            let url = "https://test.com/pos/new-cart-id";
            document.location.href = url;
        }
    </script>
    <script>
        "use strict";

        function cart_change(val) {
            let cart_id = val;
            let url = "https://test.com/pos/change-cart" + '/?cart_id=' + val;
            document.location.href = url;
        }
    </script>
    <script>
        "use strict";

        function extra_discount() {
            //let  user_id = $('#customer').val();
            let discount = $('#dis_amount').val();
            let type = $('#type_ext_dis').val();
            //let  cart_id = $('#cart_id').val();
            if (discount > 0) {
                
                toastr.success('Extra discount added successfully', {
                    CloseButton: true,
                    ProgressBar: true
                });
                $('.modal-backdrop').addClass('d-none');
                $('#cart').empty().html(data.view);

                $('#search').focus();
                    
            } else {
                toastr.warning('Amount can not be negative or zero!', {
                    CloseButton: true,
                    ProgressBar: true
                });
            }
        }
    </script>
    <script>
        "use strict";


        function evaluateTotal() {

            var total = $("#pvltotal").val();

            var pvlpaid = $("#pvlpaid").val();


            var duetotal = (total - pvlpaid);
            var due = duetotal > 0 ? duetotal.toFixed(2) : 0;
            $('#pvldue').val(due);

            // Returned Amount
            var returned = (pvlpaid - total);
            var returned_amount = returned > 0 ? returned : 0;
            if (pvlpaid > total && returned_amount > 0) {
                $("#returnedAmount").val(returned_amount.toFixed(2));
            } else {
                $("#returnedAmount").val(returned_amount.toFixed(2));
            }


        }

        function coupon_discount() {

            let coupon_code = $('#coupon_code').val();
            var data = {coupon:"success"};
            if (data.coupon === 'success') {
                toastr.success('Coupon added successfully', {
                    CloseButton: true,
                    ProgressBar: true
                });
            } else if (data.coupon === 'amount_low') {
                toastr.warning('This discount is not applied for this amount', {
                    CloseButton: true,
                    ProgressBar: true
                });
            } else if (data.coupon === 'cart_empty') {
                toastr.warning('Your cart is empty', {
                    CloseButton: true,
                    ProgressBar: true
                });
            } else {
                toastr.warning('Coupon is invalid', {
                    CloseButton: true,
                    ProgressBar: true
                });
            }

            $('#cart').empty().html(data.view);

            $('#search').focus();

        }
    </script>
    <script>
        $(document).on('ready', function() {
        });

        function printDiv(divName) {
            var printContents = document.getElementById(divName).innerHTML;
            var originalContents = document.body.innerHTML;
            document.body.innerHTML = printContents;
            window.print();
            document.body.innerHTML = originalContents;
            location.reload();
        }

        function set_category_filter(id) {
            var nurl = new URL('https://test.com');
            nurl.searchParams.set('category_id', id);
            location.href = nurl;
        }

        function set_vendor_filter(id) {
            var nurl = new URL('https://test.com');
            nurl.searchParams.set('vendor_id', id);
            location.href = nurl;
        }

        $('#search-form').on('submit', function(e) {
            e.preventDefault();
            var keyword = $('#datatableSearch').val();
            var nurl = new URL('https://test.com');
            nurl.searchParams.set('keyword', keyword);
            location.href = nurl;
        });

        function thermalapi(url) {
            toastr.success('Success!', {
                CloseButton: true,
                ProgressBar: true
            });
        }

        function store_key(key, value) {
            toastr.success(key + ' ' + 'Selected!', {
                CloseButton: true,
                ProgressBar: true
            });
        }

        function addon_quantity_input_toggle(e) {
            var cb = $(e.target);
            if (cb.is(":checked")) {
                cb.siblings('.addon-quantity-input').css({
                    'visibility': 'visible'
                });
            } else {
                cb.siblings('.addon-quantity-input').css({
                    'visibility': 'hidden'
                });
            }
        }

        function quickView(product_id) {
            $('#quick-view').modal('show');
            $('#quick-view-modal').empty().html(data.view);
        }

        function emrgQuickView(product_id) {
            console.log("success...");
            $('#emrg-quick-view').modal('show');
            $('#emrg-quick-view-modal').empty().html(data.view);
        }

        function checkAddToCartValidity() {
            var names = {};
            $('#add-to-cart-form input:radio').each(function() { // find unique names
                names[$(this).attr('name')] = true;
            });
            var count = 0;
            $.each(names, function() { // then count them
                count++;
            });
            if ($('input:radio:checked').length == count) {
                return true;
            }
            return false;
        }

        function cartQuantityInitialize() {
            $('.btn-number').click(function(e) {
                e.preventDefault();

                var fieldName = $(this).attr('data-field');
                var type = $(this).attr('data-type');
                var input = $("input[name='" + fieldName + "']");
                var currentVal = parseInt(input.val());

                if (!isNaN(currentVal)) {
                    if (type == 'minus') {

                        if (currentVal > input.attr('min')) {
                            input.val(currentVal - 1).change();
                        }
                        if (parseInt(input.val()) == input.attr('min')) {
                            $(this).attr('disabled', true);
                        }

                    } else if (type == 'plus') {

                        if (currentVal < input.attr('max')) {
                            input.val(currentVal + 1).change();
                        }
                        if (parseInt(input.val()) == input.attr('max')) {
                            $(this).attr('disabled', true);
                        }

                    }
                } else {
                    input.val(0);
                }
            });

            $('.input-number').focusin(function() {
                $(this).data('oldValue', $(this).val());
            });

            $('.input-number').change(function() {

                minValue = parseInt($(this).attr('min'));
                maxValue = parseInt($(this).attr('max'));
                valueCurrent = parseInt($(this).val());

                var name = $(this).attr('name');
                if (valueCurrent >= minValue) {
                    $(".btn-number[data-type='minus'][data-field='" + name + "']").removeAttr('disabled')
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Cart',
                        text: 'Sorry, the minimum value was reached'
                    });
                    $(this).val($(this).data('oldValue'));
                }
                if (valueCurrent <= maxValue) {
                    $(".btn-number[data-type='plus'][data-field='" + name + "']").removeAttr('disabled')
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Cart',
                        text: 'Sorry, stock limit exceeded.'
                    });
                    $(this).val($(this).data('oldValue'));
                }
            });
            $(".input-number").keydown(function(e) {
                // Allow: backspace, delete, tab, escape, enter and .
                if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190]) !== -1 ||
                    // Allow: Ctrl+A
                    (e.keyCode == 65 && e.ctrlKey === true) ||
                    // Allow: home, end, left, right
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                    // let it happen, don't do anything
                    return;
                }
                // Ensure that it is a number and stop the keypress
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            });
        }

        function getVariantPrice() {
            if ($('#add-to-cart-form input[name=quantity]').val() > 0 && checkAddToCartValidity()) {
                
                $('#add-to-cart-form #chosen_price_div').removeClass('d-none');
                $('#add-to-cart-form #chosen_price_div #chosen_price').html(data.price);
                $('#set-discount-amount').html(data.discount);
            }
        }

        function addTo_Cart(form_id = 'add-to-cart-form') {
            if (checkAddToCartValidity()) {
                toastr.success('Item has been added in your cart!', {
                    CloseButton: true,
                    ProgressBar: true
                });
            } else {
                Swal.fire({
                    type: 'info',
                    title: 'Cart',
                    text: 'Please choose all the options'
                });
            }
        }

        function addToBatch(form_id = 'add-to-batch-form') {
            if (checkAddToCartValidity()) {
                toastr.success('Item has been added in your cart!', {
                    CloseButton: true,
                    ProgressBar: true
                });
            } else {
                Swal.fire({
                    type: 'info',
                    title: 'Cart',
                    text: 'Please choose all the options'
                });
            }
        }

        function removeFromCart(key) {
            //console.log(key);
            
            toastr.info('Item has been removed from cart', {
                CloseButton: true,
                ProgressBar: true
            });
        }

        function emptyCart() {
            Swal.fire({
                title: 'Are you sure ',
                text: 'You want to remove all items from cart!!',
                type: 'warning',
                showCancelButton: true,
                cancelButtonColor: 'default',
                confirmButtonColor: '#161853',
                cancelButtonText: 'No',
                confirmButtonText: 'Yes',
                reverseButtons: true
            }).then((result) => {
                if (result.value) {
                    
                    toastr.info('Item has been removed from cart', {
                        CloseButton: true,
                        ProgressBar: true
                    });
                }
            })
        }

        function updateCart() {
            
        }

        $(function() {
            $(document).on('click', 'input[type=number]', function() {
                this.select();
            });
        });


        function updateQuantity(key, batch, qty, e) {

            if (qty !== "") {
                var element = $(e.target);
                var minValue = parseInt(element.attr('min'));
                // maxValue = parseInt(element.attr('max'));
                var valueCurrent = parseInt(element.val());
            } else {
                var element = $(e.target);
                var minValue = parseInt(element.attr('min'));
                var valueCurrent = parseInt(element.val());

            }

            // Allow: backspace, delete, tab, escape, enter and .
            if (e.type == 'keydown') {
                if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190]) !== -1 ||
                    // Allow: Ctrl+A
                    (e.keyCode == 65 && e.ctrlKey === true) ||
                    // Allow: home, end, left, right
                    (e.keyCode >= 35 && e.keyCode <= 39)) {
                    // let it happen, don't do anything
                    return;
                }
                // Ensure that it is a number and stop the keypress
                if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
                    e.preventDefault();
                }
            }

        };

        
        $('#order_place').submit(function(eventObj) {
            if ($('#customer').val()) {
                $(this).append('<input type="hidden" name="user_id" value="' + $('#customer').val() + '" /> ');
            }
            return true;
        });
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.min.js" integrity="sha256-+C0A5Ilqmu4QcSPxrlGpaZxJ04VjsRjKu+G82kl5UJk=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.bootstrap3.min.css" integrity="sha256-ze/OEYGcFbPRmvCnrSeKbRTtjG4vGLHXgOqsyLFTRjg=" crossorigin="anonymous" />
    <script>
        $(document).ready(function () {
            $('select').selectize({
               
            });
        });
    </script>
</body>
</html>
